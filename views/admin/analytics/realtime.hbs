{{!-- views/admin/analytics/realtime.hbs --}}
<div style="max-width:1400px; margin:0 auto; padding:20px;">

  <div style="margin-bottom:24px;">
    <a href="/admin/analytics" style="color:#D4AF37; text-decoration:none; font-weight:600;">‚Üê Back to Dashboard</a>
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:32px;">
    <div>
      <h1 style="margin:0 0 8px 0; font-size:32px; font-weight:800;">‚ö° Real-time Analytics</h1>
      <div style="color:#888; font-size:14px;">Live visitor tracking (last 5 minutes)</div>
    </div>

    <div style="display:flex; align-items:center; gap:12px;">
      <div class="pulse-dot"></div>
      <span style="font-weight:700; font-size:24px;">{{activeNow}}</span>
      <span style="color:#888;">active now</span>
    </div>
  </div>

  {{!-- Auto-refresh notice --}}
  <div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:12px 16px; margin-bottom:24px; display:flex; align-items:center; gap:12px;">
    <span style="font-size:20px;">üîÑ</span>
    <span style="color:#888;">Auto-refreshing every 10 seconds</span>
    <button id="pauseRefresh" style="margin-left:auto; padding:6px 12px; background:#333; border:none; color:#fff; border-radius:6px; cursor:pointer; font-weight:600;">
      Pause
    </button>
  </div>

  {{!-- Recent activity table --}}
  <div style="background:#0f0f0f; border:1px solid #222; border-radius:12px; padding:24px;">
    <h3 style="margin:0 0 20px 0; font-size:20px; font-weight:700;">üî• Recent Activity</h3>
    
    <table id="activityTable" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="border-bottom:2px solid #222;">
          <th style="text-align:left; padding:12px 8px; font-weight:600; color:#888;">Time</th>
          <th style="text-align:left; padding:12px 8px; font-weight:600; color:#888;">User</th>
          <th style="text-align:left; padding:12px 8px; font-weight:600; color:#888;">Page</th>
          <th style="text-align:left; padding:12px 8px; font-weight:600; color:#888;">Device</th>
          <th style="text-align:right; padding:12px 8px; font-weight:600; color:#888;">Response</th>
        </tr>
      </thead>
      <tbody>
        {{#each recentPages}}
          <tr style="border-bottom:1px solid #111;">
            <td style="padding:12px 8px; color:#888; font-size:13px;">
              {{formatDate timestamp}}
            </td>
            <td style="padding:12px 8px;">
              {{#if userId}}
                <div style="display:flex; align-items:center; gap:8px;">
                  <span style="background:#D4AF37; color:#000; padding:4px 8px; border-radius:6px; font-size:11px; font-weight:700;">
                    {{userRole}}
                  </span>
                  <span>{{userId.firstName}} {{userId.lastName}}</span>
                </div>
              {{else}}
                <span style="color:#666; font-style:italic;">Anonymous</span>
              {{/if}}
            </td>
            <td style="padding:12px 8px; font-family:monospace; font-size:13px;">
              {{path}}
            </td>
            <td style="padding:12px 8px; font-size:13px;">
              {{#if device.browser}}
                {{device.browser}} / {{device.type}}
              {{else}}
                Unknown
              {{/if}}
            </td>
            <td style="padding:12px 8px; text-align:right;">
              {{#if responseTime}}
                <span style="color:{{#if (lt responseTime 200)}}#4CAF50{{else if (lt responseTime 500)}}#FFC107{{else}}#f44336{{/if}};">
                  {{responseTime}}ms
                </span>
              {{else}}
                -
              {{/if}}
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>

    {{#unless recentPages}}
      <div style="text-align:center; padding:40px; color:#666;">
        <div style="font-size:48px; margin-bottom:12px;">üò¥</div>
        <div>No recent activity in the last 5 minutes</div>
      </div>
    {{/unless}}
  </div>

</div>

<style>
  .pulse-dot {
    width: 12px;
    height: 12px;
    background: #4CAF50;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
    }
  }

  #pauseRefresh:hover {
    background: #444;
  }
</style>

<script>
  let refreshInterval;
  let isPaused = false;

  function startAutoRefresh() {
    refreshInterval = setInterval(() => {
      if (!isPaused) {
        location.reload();
      }
    }, 10000); // 10 seconds
  }

  document.getElementById('pauseRefresh').addEventListener('click', function() {
    isPaused = !isPaused;
    this.textContent = isPaused ? 'Resume' : 'Pause';
    this.style.background = isPaused ? '#D4AF37' : '#333';
    this.style.color = isPaused ? '#000' : '#fff';
  });

  startAutoRefresh();
</script>