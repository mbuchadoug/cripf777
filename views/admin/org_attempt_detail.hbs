{{! views/admin/org_attempt_detail.hbs }}
<a href="/admin/orgs/{{org.slug}}/attempts">← Back to attempts</a>

<h1>Attempt Review — {{org.name}}</h1>
<p>User: ({{user && user.email}})</p>

<div class="meta">
  <strong>Module:</strong> {{attempt.module}} &nbsp;
  <strong>Score:</strong> {{attempt.score}} / {{attempt.maxScore}} &nbsp;
  <strong>Passed:</strong> {{#if attempt.passed}}Yes{{else}}No{{/if}}
  <div>Started: {{attempt.startedAt}} &nbsp; Finished: {{attempt.finishedAt}}</div>
</div>

{{#if qa.length}}
  {{#each qa}}
    <section class="q-block">
      <h3>Q{{index}}. {{text}}</h3>

      <div class="answers">
        {{#each choices}}
          {{!-- determine current option index --}}
          {{#let "optIndex" value=@index}}
            <div class="choice
              {{#if (eq ../yourIndex @index)}} selected{{/if}}
              {{#if (eq ../correctIndex @index)}} correct{{/if}}">
              <strong>{{letters @index}}.</strong>
              <span>{{text}}</span>
              {{#if (eq ../correctIndex @index)}} <span class="badge">✔ correct</span>{{/if}}
              {{#if (eq ../yourIndex @index)}}
                <span class="badge your">your answer</span>
              {{/if}}
            </div>
          {{/let}}
        {{/each}}
      </div>

      <p>
        Your answer: {{#if yourText}}{{yourText}}{{else}}No answer{{/if}}<br>
        Correct answer: {{#if (isNumber correctIndex)}}{{#if choices.[correctIndex]}}{{choices.[correctIndex].text}}{{else}}(not available){{/if}}{{else}}(not available){{/if}}<br>
        Result: {{#if correct}}<span class="ok">Correct ✅</span>{{else}}<span class="bad">Wrong ❌</span>{{/if}}
      </p>
    </section>
  {{/each}}
{{else}}
  <p>No per-question answer details are available for this attempt.</p>
{{/if}}
