{{!-- views/admin/org_attempt_detail.hbs --}}
<a href="/admin/orgs/{{org.slug}}/attempts">← Back to attempts</a>

<h1>Attempt Review — {{org.name}}</h1>

{{#if user}}
  <p>User: ({{user.email}})</p>
{{else}}
  <p>User: (unknown)</p>
{{/if}}

<div class="meta" style="margin:1rem 0; padding:1rem; border-radius:6px; background:#f7f7f7;">
  <strong>Module:</strong> {{attempt.module}} &nbsp;
  <strong>Score:</strong> {{attempt.score}} / {{attempt.maxScore}} &nbsp;
  <strong>Passed:</strong> {{#if attempt.passed}}Yes{{else}}No{{/if}}
  <div style="margin-top:0.5rem; font-size:0.9rem; color:#555;">
    Started: {{attempt.startedAt}} &nbsp; Finished: {{attempt.finishedAt}}
  </div>
</div>

{{#if qa}}
  {{#each qa}}
    <section style="margin-bottom:1.25rem; border-radius:10px; padding:1rem; background:#0f0f10; color:#fff;">
      <h3 style="margin:0 0 0.5rem 0; font-size:1.15rem;">Q{{index}}. {{text}}</h3>

      {{#if choices}}
        <div class="choices" style="margin-top:0.5rem;">
          {{#each choices}}
            {{!-- @index is the numeric index for this choice --}}
            <div style="padding:0.6rem; border-radius:6px; margin-bottom:0.5rem;
                        {{#if (eq ../yourIndex @index)}} box-shadow: inset 0 0 0 3px rgba(34,197,94,0.2); background:#114d12; {{else}}{{/if}}
                        {{#if (eq ../correctIndex @index)}} border:2px solid rgba(34,197,94,0.12); {{else}} border:1px solid rgba(255,255,255,0.03); {{/if}}">
              <strong style="display:inline-block; width:2rem;">{{letters @index}}.</strong>
              <span>{{text}}</span>

              {{#if (eq ../correctIndex @index)}}
                <span style="margin-left:1rem; color:#8ff2a0; font-weight:600;">✔ correct</span>
              {{/if}}
              {{#if (eq ../yourIndex @index)}}
                <span style="margin-left:1rem; color:#ffd28a; font-weight:600;">● your answer</span>
              {{/if}}
            </div>
          {{/each}}
        </div>
      {{else}}
        <div style="color:#bbb">No choices available for this question.</div>
      {{/if}}

      <p style="margin-top:0.75rem; color:#ddd; font-size:0.95rem;">
        Your answer:
        {{#if yourText}}{{yourText}}{{else}}<em>No answer</em>{{/if}}<br>
        Correct answer:
        {{#if (isNumber correctIndex)}}
          {{#if choices.[correctIndex]}}
            {{choices.[correctIndex].text}}
          {{else}}
            (not available)
          {{/if}}
        {{else}}
          (not available)
        {{/if}}<br>
        Result:
        {{#if correct}}
          <span style="color:#8ff2a0; font-weight:700;">Correct ✅</span>
        {{else}}
          <span style="color:#ff9b9b; font-weight:700;">Wrong ❌</span>
        {{/if}}
      </p>
    </section>
  {{/each}}
{{else}}
  <p>No per-question answer details are available for this attempt.</p>
{{/if}}
